name: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  send_telegram_message:
    runs-on: windows-latest
    steps:
      - name: –ü–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é
        id: get_version
        run: echo "::set-output name=VERSION::xxxx" # –í–µ—Ä—Å–∏—è –≤—Å–µ–≥–¥–∞ "xxxx"

      - name: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          RELEASE_URL: https://github.com/${{ github.repository }}/releases/tag/${{ steps.get_version.outputs.VERSION }}
        run: |
          $telegramBotToken = '${{ secrets.TELEGRAM_BOT_TOKEN }}'
          $telegramChatId = '${{ secrets.TELEGRAM_CHAT_ID }}'
          $releaseUrl = 'https://github.com/${{ github.repository }}/releases/tag/${{ steps.get_version.outputs.VERSION }}'
          $message = '–ù–æ–≤—ã–π —Ä–µ–ª–∏–∑: –°—Ç–∞—Ç–∏—á–Ω–æ–µ–ù–∞–∑–≤–∞–Ω–∏–µ–†–µ–ª–∏–∑–∞`n–í–µ—Ä—Å–∏—è: xxxx`n–û–ø–∏—Å–∞–Ω–∏–µ: –°—Ç–∞—Ç–∏—á–Ω–æ–µ–û–ø–∏—Å–∞–Ω–∏–µ`nSolution Name: –°—Ç–∞—Ç–∏—á–Ω–æ–µ–ù–∞–∑–≤–∞–Ω–∏–µ–†–µ—à–µ–Ω–∏—è`n–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ª–∏–∑: $releaseUrl'
          $uri = 'https://api.telegram.org/bot' + $telegramBotToken + '/sendMessage'
          $body = @{
              chat_id = $telegramChatId
              text = $message
          }
          $bodyJson = $body | ConvertTo-Json -Compress
          Invoke-RestMethod -Uri $uri -Method Post -Body $bodyJson -ContentType 'application/json'


          
      - name: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
        if: steps.check_release.outputs.exists == 'false' && github.event.inputs.release == 'true'
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          RELEASE_URL: 123123123
        run: |
          pwsh -Command "
          $telegramBotToken = '${{ secrets.TELEGRAM_BOT_TOKEN }}'
          $telegramChatId = '${{ secrets.TELEGRAM_CHAT_ID }}'
          $releaseUrl = 'https://github.com/${{ github.repository }}/releases/tag/${{ steps.get_version.outputs.VERSION }}'
          $message = 'üéâ *–ù–æ–≤—ã–π —Ä–µ–ª–∏–∑:* ${{ github.event.inputs.namevers }}\n\nüì¶ *–í–µ—Ä—Å–∏—è:* 123123123\n\nüìù *–û–ø–∏—Å–∞–Ω–∏–µ:* 123123123\n\nüîß *Solution Name:* 123123123\n\nüîó –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ª–∏–∑: $releaseUrl'
          $uri = 'https://api.telegram.org/bot' + $telegramBotToken + '/sendMessage'
          $body = @{
              chat_id = $telegramChatId
              text = $message
              parse_mode = 'Markdown'
          }
          Invoke-RestMethod -Uri $uri -Method Post -Body $body
          "
